# 分布式环境下产生的问题
## 可靠的消息投递？
网络通信有三种状态，成功，失败，“不知道成功还是失败”，对于“不知道成功还是失败”的也有两种处理方式
1. 消息仅投递一次，可能会造成消息丢失
2. 消息起码投递一次，也可能多次
在我们的业务系统中，如果仅仅投递一次，在网络故障的情况下数据就无法保证一致性，需要人工干预，加重工作量，而在第二种可能多次投递的情况下，服务需要满足**幂等性**的指标
>> 幂等性，同一操作多次执行所产出的结果不会发生变化
示例
```code

```
只有保证业务的幂等性，消息投递方才能放心的施展重试机制，减轻人工干预的可能性，提供给其他业务系统调用的接口，都要尽可能实现幂等性的要求(不包括天然幂等性的接口，例如查询)。
## 分布式事务
比如渠道提单扣除返利，返利扣除成功才允许订单流入下一个环节，同时要向ECP/SME同步订单信息，此处保证强一致性，订单节点转交和返利扣除以及订单同步必须处于同进同退的状态，比如返利扣除成功了，在订单处理环节后续同步的步骤失败了，此时系统如何处理
目前的做法
```code

```
如果只满足此处一个场景使用的话，简单的方式就是引用saga的思想:
1. 向后恢复，补偿事务，如果同步订单信息失败，就去回滚返利中心的数据，执行扣除返利逻辑
2. 向前恢复，重试同步订单信息，直到同步订单信息成功(幂等性的重要性也体现在这里)
### 有没有分布式事务的银弹？
在各个业务点产生的分布式事务的问题，究竟有没有银弹能解决所有的问题？
#### 我们业务系统的特征
1. 跨平台，.net和java共用
2. 国外和国内的服务器共用，具备网络波动的可能性
3. 业务的紧密关联，各个业务节点频繁的RPC
#### seata/rocketmq/saga/lcn/2pc/3pc/tcc是否是银弹？

### 结语
在分布式系统中，服务器会宕机，网络可能会超时，机房可能会停电。在这种情况下我们能做些什么？ 最后的手段是提供回退措施，比如人工干预。

